{% extends 'base.html' %}

{% block content %}
<h2 class="">{{ movie.title }}</h2><br>
<div class="d-flex justify-content-between">
  <div>
    <h4>Dane</h4><br>
    <p>Rok produkcji: {{ movie.year }}</p>
    <p>Reżyser: {{ movie.director.first_name }} {{ movie.director.last_name }}</p>
    <p>Scenariusz: {{ movie.screenplay.first_name }} {{ movie.screenplay.last_name }}</p>
    <p>Średnia ocen: {{ rating_avg }}</p>
  </div>
  <div>
    <h4>Obsada</h4><br>
    <ul class="list-group list-group-flush">
      {% for star in movie.personmovie_set.all %}
        <li class="list-group-item">
          <a href="{% url 'person' star.person.id %}"><div>{{ star.person.first_name }} {{ star.person.last_name }}</div></a>
          <strong>W roli:</strong> {{ star.role }}
          {% if user.is_authenticated %}
          <a href="{% url 'movie_person_remove' movie.id star.person.id %}"><button type="button" class="btn-sm btn-close"></button></a>
          {% endif %}
        </li>
      {% endfor %}
    </ul>
  </div>
  <div>
    <h4>Kategoria</h4><br>
    <ul class="list-group list-group-flush">
      {% for genre in movie.genre.all %}
        <li class="list-group-item">{{ genre.name }}
          {% if user.is_authenticated %}
          <a href="{% url 'movie_genre_remove' movie.id genre.id %}"><button type="button" class="btn-sm btn-close"></button></a>
          {% endif %}
        </li>
      {% endfor %}
    </ul>
  </div>
</div>

{% if user.is_authenticated %}
<div class="d-flex mt-5">
  <div class="container mx-5">
    {# empty container for spacing #}
  </div>
  <div class="container mx-5">
    <form class="" action="{% url 'movie_person_add' movie.id %}" method="POST">
      {% csrf_token %}
      <label for="person_id" class="form-label">Person:</label>
      <select class="form-select" aria-label="Default select example" id="person_id" name="person_id">
        <option selected></option>
        {% for person in people %}
        <option value="{{ person.id }}">{{ person.first_name }} {{ person.last_name }}</option>
        {% endfor %}
      </select>
      <label for="role" class="form-label">Role:</label>
      <input type="text" id="role" name="role" class="form-control" value="">
      <br>
      <button type="submit" class="btn btn-primary">ADD PERSON</button>
    </form>
  </div>
  <div class="container mx-5">
    <form class="" action="{% url 'movie_genre_add' movie.id %}" method="POST">
      {% csrf_token %}
      <label for="genre_id" class="form-label">Genre:</label>
      <select class="form-select" aria-label="Default select example" id="genre_id" name="genre_id">
        <option selected></option>
        {% for genre in genres %}
        <option value="{{ genre.id }}">{{ genre.name }}</option>
        {% endfor %}
      </select>
      <br>
      <button type="submit" class="btn btn-primary">ADD GENRE</button>
    </form>
  </div>
</div>
{% endif %}

<br>
<div class="d-flex justify-content-between my-5">
  <div class="mx-5" style="width: 70%">
    {% if ratings %}
      <h5 class="">Comments</h5>
      {% for rating in ratings %}
        <div class="card mt-4">
          <div class="card-header d-flex justify-content-between" style="height: 40px">
            <div class="">
            </div>
            <div class="d-flex justify-content-between" style="width: 15%; color: rgb(160,160,160)">
              <div class="">
                <i class="bi-clock" style="font-size: 1.2rem"></i>
              </div>
              <div class="pt-1">
                <p class="" style="font-size: 0.8rem"> {{ rating.posting_date|date:"d M Y" }}</p>
              </div>
            </div>
          </div>
          <div class="card-body d-flex justify-content-between">
            <div class="">
              <blockquote class="blockquote mb-0">
                <p style="font-size: 1rem">{{ rating.comment }}</p>
                <footer class="blockquote-footer" style="font-size: .7rem"><cite title="Source Title">{{ rating.author }}</cite></footer>
              </blockquote>
            </div>
            <div class="d-flex pt-1 justify-content-between" style="width: 12%">
              <i class="bi-star" style="font-size: 1.5rem; color: rgb(160,160,160)"></i>
              <p class="pt-2" style="font-size: .9rem">{{ rating.rating }} / 10</p>
            </div>
          </div>
        </div>
      {% endfor %}
    {% endif %}
  </div>
  {% if user.is_authenticated %}
  <div class="" style="width: 30%">
    <h5>Dodaj komentarz</h5>
    <form action="{% url 'movie_comment_add' movie.id user.id %}" method="POST">
      {% csrf_token %}
      <div class="form-group">
        <label for="rating">Oceń film</label>
        <select class="form-control" id="rating" name="rating">
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5</option>
          <option value="6">6</option>
          <option value="7">7</option>
          <option value="8">8</option>
          <option value="9">9</option>
          <option value="10">10</option>
        </select>
      </div>
      <div class="form-group">
        <label for="comment">Dodaj komenatarz</label>
        <textarea class="form-control" id="comment" rows="3" name="comment"></textarea>
      </div>
      <br>
      <button type="submit" class="btn btn-primary">Dodaj</button>
    </form>
  </div>
  {% endif %}
</div>



{% endblock %}
